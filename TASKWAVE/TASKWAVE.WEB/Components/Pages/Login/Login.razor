@page "/"
@using Microsoft.AspNetCore.Components.Authorization
@using Microsoft.AspNetCore.Identity
@using TASKWAVE.WEB.Authentication
@rendermode InteractiveServer
@layout EmptyLayout
@inject HttpClient Http
@inject NavigationManager NavigationManager
@inject AuthenticationStateProvider AuthStateProvider

<div>
	<div class="d-flex justify-content-center w-100">
		<div class="row login_card">
			<div style="max-width: 500px" class="col-md-4">
				<div class="mt-5 mb-5 d-flex justify-content-center">
					<img class="w-75" src="images/TaskWave_Logo.png" alt="Logo TaskWave" />
				</div>
				<div class="text-center">
					<p class="fs-3 text-white">Bem vindo ao TaskWave</p>
					<p class="text-white">
						Planejamento inteligente,
						resultados incríveis.
					</p>
				</div>
			</div>
			<div style="max-width: 650px" class="col-md-8 login_card_form">
				<div>
					<div class="mt-5 mb-5 text-center">
						<h1 class="text-white">Login</h1>
					</div>
					<div>
						<EditForm Model="@user" OnValidSubmit="Logar">
							<DataAnnotationsValidator />
							<ValidationSummary class="validation-summary" />

							<div class="d-flex align-items-center flex-column gap-5 mb-3 mt-3">

								<div class="form-group w-75">
									<label class="text-white fs-5" for="email">Email</label>
									<InputText id="email" class="text-white form-control shadow-none bg-transparent border-0 border-bottom rounded-0 valid" @bind-Value="user.Email" />

								</div>
								<div class="form-group w-75">
									<label class="text-white fs-5" for="senha">Senha</label>
									<InputText id="senha" type="password" class="text-white form-control shadow-none bg-transparent border-0 border-bottom rounded-0 valid" @bind-Value="user.Senha" />

								</div>
							</div>
							<div class="d-flex justify-content-center mb-5">
								<div class="w-75 d-flex justify-content-end">
									<a class="text-white mb-2" href="RecuperarSenha">Esqueci minha senha</a>
								</div>
							</div>

							<div class="d-flex align-items-center flex-column">
								<button type="submit" class="btn btn-primary rounded-3 w-50 rounded-pill fs-4">Login</button>
								<a class="text-white mt-2" href="Cadastro">Nova Conta? Cadastre-se</a>
							</div>
						</EditForm>
					</div>
					@if (!string.IsNullOrWhiteSpace(messageResponse))
					{
						<div class="alert alert-danger">@messageResponse</div>
					}
				</div>
			</div>
		</div>
	</div>
</div>

@code {

	private LoginRequest user = new LoginRequest();
	string messageResponse;

	private async Task Logar()
	{
		var response = await Http.PostAsJsonAsync("api/Auth/login", user);
		var loginResponse = await response.Content.ReadFromJsonAsync<LoginResponse>();

		if (response.IsSuccessStatusCode){
			await ((CustomAuthStateProvider)AuthStateProvider).MarkUserAsAuthenticated(loginResponse.Token);
			await ApiService.SetAuthorizeHeaderAsync();

			NavigationManager.NavigateTo("/TarefasManage");
		}else
		{
			messageResponse = "Login inválido. Verifique email e senha.";
		}
	}

}

<style>

	body {
		background-color: #333339;
		font-family: Verdana;
	}

	.login_card {
		width: 75%;
		margin-top: 55px;
		background-color: #748CAB;
		border-radius: 20px;
		min-height: 65vh;
		max-width: 900px;
	}

	.login_card_form {
		background-color: #3E5C76;
		border-radius: 20px;
	}
</style>